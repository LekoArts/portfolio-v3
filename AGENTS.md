# Agent Guidelines for portfolio-v3

This document provides essential information for AI coding agents working in this repository.

## Project Overview

Personal portfolio website built with **Astro 5**, **MDX**, **React 19**, and **vanilla-extract** for styling. Uses **pnpm** as package manager and **Netlify** for deployment.

## Build & Test Commands

### Development

```bash
pnpm dev                    # Start dev server (localhost:4321)
pnpm build                  # Production build
pnpm preview                # Preview production build
pnpm bootstrap              # Full setup: install + build Rust scripts + install Playwright
```

### Testing

```bash
pnpm test                   # Run all unit tests (vitest)
pnpm test:watch             # Run tests in watch mode
pnpm test:e2e               # Run E2E tests (Playwright)
pnpm e2e:dev                # E2E tests with UI
pnpm e2e:build              # E2E tests against production build
```

### Running a Single Test

```bash
# Unit tests (vitest)
pnpm vitest run src/utils/__tests__/box.ts

# E2E tests (Playwright)
pnpm playwright test playwright/navigation.spec.ts
```

### Linting

```bash
pnpm lint                   # Run ESLint
pnpm lint:fix                # Auto-fix ESLint issues
pnpm lint:title-case        # Check blog post titles (Rust binary)
```

### Custom Scripts

```bash
pnpm new-post               # Create new blog post (Rust binary)
pnpm rs:build               # Build Rust scripts in scripts/
```

## Code Style Guidelines

### Formatting & Linting

- **Linter**: ESLint with @antfu/eslint-config
- **Indentation**: Tabs (not spaces)
- **Quotes**: Single quotes (except to avoid escaping)
- **Semicolons**: No semicolons
- **Line length**: No strict limit, but keep readable

### Import Organization

Imports should be organized in this order:

1. Type imports from external packages
2. Regular imports from external packages
3. Type imports from internal modules
4. Regular imports from internal modules (use path aliases)
5. CSS imports

```typescript
import type { Atoms } from '@styles/atoms.css'
import type { CollectionEntry } from 'astro:content'
import { atoms } from '@styles/atoms.css'
import { filterPublished } from '@utils/collection'
import { getCollection } from 'astro:content'
```

### Path Aliases

Use TypeScript path aliases consistently:

- `@assets/*` - Static assets
- `@components/*` - All components
- `@constants/*` - Constants and configurations
- `@layouts/*` - Layout components
- `@lib/*` - Library functions
- `@stores/*` - Nanostores
- `@styles/*` - Styling (vanilla-extract)
- `@utils/*` - Utility functions

### TypeScript

- **Strict mode**: Enabled (extends `astro/tsconfigs/strict`)
- **Explicit types**: Use explicit types for function parameters and return values
- **Interfaces over types**: Prefer `interface` for object shapes, `type` for unions/intersections
- **Naming**: Use `PascalCase` for types/interfaces, prefix interfaces with `I` only when necessary
- **Type imports**: Use `import type` for type-only imports

```typescript
// Good
// Bad - missing return type, no type import
import { CollectionEntry } from 'astro:content'

interface Props {
	variant: Badges
}

export function filterPublished(entry: CollectionEntry<'writing'>): boolean {
	return import.meta.env.PROD ? entry.data.published : true
}
export function filterPublished(entry: CollectionEntry<'writing'>) {
	return import.meta.env.PROD ? entry.data.published : true
}
```

### Naming Conventions

- **Files**: kebab-case (e.g., `skip-nav-content.astro`, `box.css.ts`)
- **Components**: PascalCase in code, kebab-case for files
- **Functions**: camelCase
- **Constants**: SCREAMING_SNAKE_CASE for true constants, camelCase for config objects
- **CSS classes**: Generated by vanilla-extract, use descriptive names

### Astro Components

- Use frontmatter for logic, keep templates minimal
- Destructure props at the top of frontmatter
- Use `type` or `interface` for Props
- Prefer composition with `<slot />` over complex props

```astro
---
import type { Badges } from './badge.css'
import { badgeVariants } from './badge.css'
import Box from '@components/primitives/box.astro'

interface Props {
	variant: Badges
}

const { variant } = Astro.props
---

<Box as="span" class={badgeVariants[variant]}>
	<slot />
</Box>
```

### React Components

- Use functional components with TypeScript
- Use `React.FC` for components with children
- Destructure props in function parameters
- Use `interface` for props

```typescript
interface IPlaygroundProps {
	files: Record<string, string>
	template?: SandpackPredefinedTemplate
	title: string
}

export function Playground({ files, template = 'react', title }: IPlaygroundProps) {
	// Component logic
}
```

### Error Handling

- Validate inputs at function boundaries
- Throw errors for invalid usage (e.g., incorrect prop types)
- Use optional chaining and nullish coalescing for safe property access
- Provide meaningful error messages

```typescript
// Good - validates input
if (typeof style === 'string') {
	throw new TypeError('`style` prop must be an object. Did you forget to use `style={{}}`?')
}

// Good - safe access
if (entry.data.series?.id === seriesId) {
	// ...
}
```

### Comments & Documentation

- Use JSDoc for public APIs and complex functions
- Prefer self-documenting code over comments
- Add TODO comments with context when needed
- Document "why" not "what"

```typescript
/**
 * Converts pixel to a 16px based rem value
 * @param px
 * @returns Rounded 16px base rem value
 * @example rem(16) => 1rem
 */
export const rem = (px: number) => `${round(px / 16)}rem`
```

## Testing Guidelines

- **Unit tests**: Located in `src/**/__tests__/` directories
- **Test files**: Same name as source file (e.g., `box.ts` â†’ `__tests__/box.ts`)
- **E2E tests**: Located in `playwright/` directory
- **Framework**: Vitest for unit tests, Playwright for E2E
- **Globals**: Enabled for vitest (use `describe`, `it`, `expect` without imports)

## Content Management

- Blog posts: MDX files in `src/content/writing/`
- Images: Store in `src/content/writing/_img/` or `public/`
- Navigation: YAML files in `src/content/navigations/`
- Content schema: Defined in `src/content.config.ts` using Zod

## Styling with vanilla-extract

- CSS files: Use `.css.ts` extension
- Keep styles colocated with components
- Use design tokens from `src/styles/tokens/`
- Use sprinkles/atoms for atomic CSS patterns
- Leverage TypeScript for type-safe styles

## Environment Variables

Defined in `astro.config.ts` using Astro's env schema:

- `GITHUB_TOKEN` (secret, server) - Required for GitHub API
- `IS_PLAYWRIGHT` (public, server, optional) - E2E testing flag

## Important Notes

- **No LICENSE**: Code is viewable but not for reuse or commercial purposes
- **Rust scripts**: Custom tooling in `scripts/` directory (requires `cargo build`)
- **Playwright adapter**: Build excludes Netlify adapter when `IS_PLAYWRIGHT=true`
- **Path handling**: Always use `normalize()` from `@utils/slash` for content slugs
